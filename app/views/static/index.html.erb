<div class="flex flex-col lg:flex-row lg:gap-9 pt-4 md:pt-10">
  <!-- Left Column: Headline + Form -->
  <div class="lg:w-1/2 w-full">
    <h1 class="text-2xl md:text-[27px] font-semibold tracking-tight mb-2 md:mb-[10px]">
      Find the <span style="color: #E63946">SEV-1</span> before it hits prod.
    </h1>
    <p class="text-gray-800 mb-6 md:mb-[16px] leading-relaxed text-[17px]">
      Weekly <span class="font-semibold">email-based drills</span> that uncover your team's infra blind spots. GPT pushes you to failure, <span class="font-semibold">then</span> coaches.
    </p>

    <div class="md:hidden mb-8">
      <%= render "email_preview" %>
    </div>


    <%= form_for Conversation.new, url: conversations_path, html: { id: "demo-form", class: "hidden lg:block" } do |f| %>
      <div class="rounded-xl border border-neutral-150 bg-neutral-100 p-5 shadow leading-snug">
        <label for="initial_message" class="block font-semibold text-gray-900 leading-snug text-[17px]">
          What broke recently?
        </label>
        <p class="mt-1 text-[15px] text-gray-600 leading-normal">
          Let's visualize the risk showing up in a weekly SEV drill.
        </p>

        <%= text_area_tag :incident, "", class: "mt-4 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-sm text-gray-900 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 focus:ring-0", rows: 3, placeholder: "e.g., retries quietly corrupted the audit trail", tabindex: 1 %>
        <%= hidden_field_tag :engineer_name, "Alex Shaw", name: "engineer_name", class: "hidden" %>

        <p class="mt-3 text-xs text-center text-gray-500">
          By submitting, you agree to the
          <a href="/terms" class="text-blue-500 hover:underline">Terms</a> and
          <a href="/privacy" class="text-blue-500 hover:underline">Privacy Policy</a>
        </p>
      </div>

      <div class="text-center mt-6">
        <%= f.submit 'Preview coaching thread'.html_safe, class: 'cursor-pointer rounded-lg px-5 py-2.5 text-[20px] font-semibold text-white bg-slate-600 hover:bg-slate-700 active:bg-slate-800 transition shadow-sm hover:shadow-md focus:outline-none tracking-tight', tabindex: 3 %>
      </div>
      <div class="mt-4 text-[15px] text-center" style="opacity: 90%">
        No tricks. One <span class="font-bold" style="font-family: 'Source Code Pro'">&lt;textarea/&gt;</span>
      </div>
    <% end %>
  </div>

  <div class="lg:w-1/2 w-full">
    <div class="hidden md:block">
      <%= render "email_preview" %>
      <div class="mt-3">
        <%= render "signature" %>
      </div>
    </div>
  </div>
</div>

<div>
  <div class="text-md leading-relaxed tracking-[0.008em]">
    <div class="text-[17px]">

      <div class="md:mt-12 max-w-[90ch] text-[17px] leading-relaxed text-gray-800">
        <p class="mb-6">
          This product helps <span class="font-semibold">mid-market engineering teams</span> sharpen their production instincts. It's a <span class="font-semibold">weekly fire drill</span>, over email.
        </p>

        <p class="mb-6">
          GPT drops you into a SEV-1<span class="hidden md:inline"> with some clues</span>, and makes you explain your thoughts until you hit a wall. <span class="block my-6 lg:inline lg:my-0"> No UI. It just shows up in your inbox and applies pressure. Test first, find the blind spot that will eventually crash prod, <span class="font-semibold">then</span> coach.</span>
        </p>

        <p class="mb-6">
          Here's the <a href="/intro-email.png" class="text-blue-600 hover:underline font-semibold" target="_blank" tabindex="-1">email format</a>. Roll it out in <span class="font-semibold">5 minutes</span> during your <span class="font-semibold">3-month trial</span>. Fixed pricing. 100% async. No calls. No setup.
        </p>

      </div>
      <div class="mt-8 lg:mt-10 flex gap-6">
        <% EXAMPLE_EMAILS.each_with_index do |email, i| %>
          <div class="md:basis/1-2 lg:basis-1/3 bg-white border border-neutral-100 shadow rounded-xl p-5 space-y-4 <%= i == 0 ? "hidden md:block" : "" %> <%= i == 1 ? "hidden lg:block" : "" %> <%= i == 2 ? "md:block" : "" %>">
            <div class="flex items-center justify-between align-middle">
              <div class="text-sm text-gray-500"><%= email[:to] %></div>
              <img src="/profile-photo-<%= i + 1 %>.jpg" alt="Avatar" class="w-10 h-10 rounded-full overflow-hidden" />
            </div>

            <div class="text-base font-semibold text-gray-900"><%= email[:subject].html_safe %></div>
            <div class="text-sm text-gray-700 leading-relaxed"><%= email[:content].html_safe %></div>

            <div>
              <a href="#" data-example="<%= email[:prompt] %>" data-name="<%= email[:to] %>" class="example-btn inline-block rounded-md border border-gray-300 bg-white text-sm text-gray-800 font-medium px-3 py-2 hover:bg-neutral-100">
                Prevent the fire
              </a>
            </div>

            <div class="text-xs text-gray-400 pt-2">
              Sent automatically every Monday
            </div>
          </div>
        <% end %>
      </div>
      <div class="mt-8 lg:mt-12">
        <img src="/example-incidents.jpg" class="w-full rounded-xl border border-gray-700" />
      </div>
    </div>
  </div>

  <div class="mt-8 md:mt-16 w-full lg:max-w-[780px] rounded-lg shadow-md border border-gray-100 bg-white mx-auto md:hidden">
    <div class="md:flex md:flex-row items-center justify-between bg-[#393E46] px-4 py-2.5 rounded-t-lg">
      <div class="text-[15px] text-[#FFFFFF] tracking-tight text-shadow" style="font-family: 'DM Mono'">
        SEV-1 Training: Admin access granted without explicit intent
      </div>
      <div class="text-[13px] text-zinc-300 hidden md:block ml-2">
        <span class="font-semibold">Sep 8, 2025</span><span class="hidden lg:inline"> - 12:04pm ET</span>
      </div>
    </div>

    <div class="text-[16px] p-5">
      <div class="space-y-8 leading-[1.6]">
        <div class="flex justify-start">
          <div class="break-words message-body">
            <div class="font-medium flex items-center gap-2 mb-2">
              <img src="/logo.png" alt="replicate.info" class="w-6 h-6 rounded-full" />
              replicate.info
            </div>
            <div class="mt-1">
              Imagine reviewing an IAM audit log and seeing a service account granted admin privileges within a Kubernetes cluster. The action lists a single API request with no associated approval workflow. The originating user is tagged with an expired session ID.
              <br><br>
              <span class="font-semibold">What’s your first move here?</span>
            </div>
          </div>
        </div>

        <div class="flex justify-end">
          <div class="bg-neutral-100 rounded-2xl shadow px-4 py-3 max-w-2xl md:max-w-xl break-words message-body">
            <div class="font-medium mb-1">Jordan Kim</div>
            I’d start by checking how we’re validating the role claim in the token. If we’re trusting it directly from the SSO provider without verifying against internal user records or scopes, that’s probably the gap. Also curious if the token was reused. Maybe no jti or nonce checks?
          </div>
        </div>

        <div class="flex justify-start">
          <div class="break-words message-body">
            <div class="font-medium flex items-center gap-2 mb-2">
              <img src="/logo.png" alt="replicate.info" class="w-6 h-6 rounded-full" />
              replicate.info
            </div>
            <div class="mt-1">
              Did you address why <strong>"scope"</strong> validation didn’t block admin actions? If the token allows admin operations despite mismatched scopes, <strong>what other payload fields might authorization implicitly trust?</strong> Where else might incomplete validation propagate?
            </div>
          </div>
        </div>

        <div class="flex justify-end">
          <div class="bg-neutral-100 rounded-2xl shadow px-4 py-3 max-w-2xl md:max-w-xl break-words message-body">
            <div class="font-medium mb-1">Jordan Kim</div>
            If scope didn’t block admin actions, we may be over-trusting role=admin without validating scope. I’d check if the authz layer defaults when claims are missing, and whether weak or partial tokens still create valid sessions. Sounds like the system may be failing open.
          </div>
        </div>

        <div class="flex justify-end">
          <div class="bg-neutral-100 rounded-2xl shadow px-4 py-3 max-w-2xl md:max-w-xl break-words message-body">
            <div class="font-medium mb-1">Jordan Kim</div>
            I’d also look at what other fields the system implicitly trusts. If the token had missing or malformed claims but still resulted in a valid session, maybe we’re silently defaulting to permissive behavior instead of failing closed. That could mean any weakly-signed or replayed token could slip through if one trusted field is present. Feels like the validation pipeline isn’t strict enough around partial success paths.
          </div>
        </div>

        <div class="flex justify-start">
          <div class="break-words message-body">
            <div class="font-medium flex items-center gap-2 mb-2">
              <img src="/logo.png" alt="replicate.info" class="w-6 h-6 rounded-full" />
              replicate.info
            </div>
            <div class="mt-1">
              How does the system reconcile scopes with roles during request execution? If scope mismatches don’t block, could partial matches or absent roles escalate privileges elsewhere? Where else do assumptions about claim integrity cascade?
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-8 hidden md:block">
    <img src="/intro-email.png" class="border rounded-lg shadow w-full" />
  </div>

  <div class="mt-6 w-full lg:max-w-[780px] mx-auto text-center">
    <a href="/sev" class="text-md md:text-[17px] tracking-tight shadow inline-block rounded-lg bg-indigo-700 px-5 py-3 font-semibold text-white transition hover:bg-indigo-800 hover:shadow-md active:bg-indigo-900 sm:w-auto focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400" target="_blank">Try the web-based version</a>
  </div>
  <div class="mt-4 mb-14 md:mb-0 text-sm text-center text-gray-500">
    No logins. No credit cards.
  </div>

  <div class="mt-8 lg:mt-14">
    <%= render "extended_cta" %>
  </div>
</div>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("demo-form");

    const exampleButtons = document.querySelectorAll(".example-btn");
    const engineer_name = document.querySelector("input[name='engineer_name']");
    const textarea = document.querySelector("textarea[name='incident']");
    const exampleContainer = document.getElementById("example-buttons");

    exampleButtons.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        textarea.value = btn.dataset.example;
        engineer_name.value = btn.dataset.name;
        form.submit(); // Submit the form immediately
      });
    });
  });
</script>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector('form[action="/remind"]');
    const emailInput = form.querySelector('input[name="email"]');
    const submitBtn = form.querySelector('button[type="submit"]');

    // Inline error and success containers
    const errorMsg = document.createElement("div");
    errorMsg.className = "text-red-600 text-sm mt-2";
    form.appendChild(errorMsg);

    const successMsg = document.createElement("div");
    successMsg.className = "text-md";
    successMsg.innerHTML = `
  <div>
    <span class="font-medium">Subscribed!</span> Expect high-signal incidents every few weeks.
  </div>
  <div class="mt-4">
    Try the
    <a href="/sev" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">
      web-based version
    </a> if you want to level up in the meantime.
  </div>
`;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorMsg.textContent = "";

      const email = emailInput.value.trim();
      const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

      if (!isValid) {
        errorMsg.textContent = "Please enter a valid email address.";
        return;
      }

      try {
        const response = await fetch("/subscribers", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content,
          },
          body: JSON.stringify({ subscriber: { email } }),
        });

        if (response.ok) {
          const heading = form.closest("div").querySelector("p.text-xl");
          const description = heading?.nextElementSibling;

          if (heading) heading.style.display = "none";
          if (description) description.style.display = "none";
          form.replaceWith(successMsg);
        } else {
          errorMsg.textContent = "Something went wrong. Please try again later.";
        }
      } catch (err) {
        errorMsg.textContent = "Network error. Please try again.";
      }
    });
  });
</script>
<div class="mr-2">
</div>