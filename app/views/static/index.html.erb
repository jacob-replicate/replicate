<div class="flex flex-col lg:flex-row gap-9 pt-4 md:pt-10">
  <!-- Left Column: Headline + Form -->
  <div class="lg:w-1/2 w-full">
    <h1 class="text-2xl md:text-3xl font-semibold tracking-tight mb-2">
      Your next outage is avoidable.
    </h1>
    <p class="text-gray-800 mb-4 leading-relaxed text-[17px]">
      Weekly emails that uncover your team's infra and security blind spots, followed by personalized coaching from GPT.
    </p>

    <div class="md:hidden mb-6">
      <%= render "email_preview" %>
    </div>


    <%= form_for Conversation.new, url: conversations_path, html: { id: "demo-form" } do |f| %>
      <div class="rounded-xl border border-neutral-150 bg-neutral-100 p-5 shadow leading-snug">
        <label for="initial_message" class="block font-semibold text-gray-900 leading-snug text-[17px]">
          What broke recently?
        </label>
        <p class="mt-1 text-[15px] text-gray-600 leading-normal">
          Let's figure out what you missed.
        </p>

        <%= text_area_tag :incident, "", class: "mt-4 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-sm text-gray-900 placeholder:text-gray-400 focus:border-indigo-600 focus:ring-0", rows: 3, placeholder: "e.g., retries quietly corrupted the audit trail", tabindex: 1 %>
        <%= hidden_field_tag :engineer_name, "Alex Shaw", name: "engineer_name", class: "hidden" %>

        <p class="mt-3 text-xs text-center text-gray-500">
          By submitting, you agree to the
          <a href="/terms" class="text-blue-500 hover:underline">Terms</a> and
          <a href="/privacy" class="text-blue-500 hover:underline">Privacy Policy</a>
        </p>
      </div>

      <div class="text-center mt-6">
        <%= f.submit 'Start the real postmortem&nbsp;&nbsp;&rarr;'.html_safe, class: 'cursor-pointer rounded-lg px-5 py-2.5 text-lg font-semibold text-white bg-slate-600 hover:bg-slate-700 active:bg-slate-800 transition shadow-sm hover:shadow-md focus:outline-none', tabindex: 3 %>
      </div>
      <div class="mt-4 text-sm text-center text-gray-500">
        No logins. No credit cards.
      </div>
    <% end %>
  </div>

  <div class="lg:w-1/2 w-full">
    <div class="hidden md:block">
      <%= render "email_preview" %>
      <%= render "signature" %>
    </div>
  </div>
</div>

<div class="pb-6">
  <div class="text-md leading-relaxed tracking-[0.008em]">
    <div class="text-[17px]">

      <div class="mt-2 md:mt-12 max-w-[90ch] text-[17px] leading-relaxed text-gray-800 space-y-6 mb-10">
        <p>
          <span class="font-medium">replicate.info</span> helps engineers sharpen their production instincts. No UI. No logins. Just weekly emails that pressure test your knowledge of infra and security fundamentals. It's not meant to feel comfortable. It's meant to feel like a fire drill.
        </p>

        <p>
          It drops you into the middle of a SEV-1, and asks where you'd look first. GPT pushes back, challenging your thinking until you reach failure. <span class="block mt-6 lg:inline lg:mt-0">Forget 300-page books. Test first, find the blind spot that will eventually take down prod, <span class="font-semibold">then</span> coach.</span>
        </p>

        <p>
          No tracking. No reports for your manager. Just a 5-minute puzzle that nudges you to an <span class="italic font-medium">"aha!"</span> moment, 52 times per year.
        </p>
      </div>
      <div class="mb-8 flex gap-6">
        <% EXAMPLE_EMAILS.each_with_index do |email, i| %>
          <div class="md:basis/1-2 lg:basis-1/3 bg-white border border-gray-100 shadow rounded-xl p-5 space-y-4 <%= i == 0 ? "hidden md:block" : "" %> <%= i == 1 ? "hidden lg:block" : "" %> <%= i == 2 ? "md:block" : "" %>">
            <div class="flex items-center justify-between align-middle">
              <div class="text-sm text-gray-500"><%= email[:to] %></div>
              <img src="/profile-photo-<%= i + 1 %>.jpg" alt="Avatar" class="w-10 h-10 rounded-full overflow-hidden" />
            </div>

            <div class="text-base font-semibold text-gray-900"><%= email[:subject].html_safe %></div>
            <div class="text-sm text-gray-700 leading-relaxed"><%= email[:content] %></div>

            <div>
              <a href="#" data-example="<%= email[:prompt] %>" data-name="<%= email[:to] %>" class="example-btn inline-block rounded-md border border-gray-300 bg-white text-sm text-gray-800 font-medium px-3 py-2 hover:bg-gray-100">
                Prevent the fire
              </a>
            </div>

            <div class="text-xs text-gray-400 pt-2">
              Sent automatically every Monday
            </div>
          </div>
        <% end %>
      </div>
      <div class="mt-14 max-w-[90ch] text-[17px] leading-relaxed text-gray-800">
        <div class="lg:flex gap-8">
          <div class="lg:basis-1/2 space-y-6">
            <p class="text-xl font-semibold tracking-tight">
              Next Steps
            </p>
            <p>
              Add your emails <a href="/demo" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">here</a> to start next Monday.
            </p>
            <p>
              Everyone gets the same incident each week, and their own private email thread to work through the problem. No UI. No tracking. Just a safe space to fix your blind spots, and brainstorm the ticket that will prevent your next SEV-1.
            </p>
            <p>
              <span class="font-medium">Your first full month is free.</span> No credit cards. No demos.
            </p>
            <p>
              Want to learn about <a href="/security" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">user provisioning</a>, <a href="/security" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">data security</a>, and <a href="/billing" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">billing</a>? It takes 5min to roll out across your entire org. You'll be surprised how quickly it changes the culture.
            </p>
            <p class="text-sm hidden lg:block">
              <a href="mailto:support@replicate.info" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 inline-block mr-2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                </svg>

                support@replicate.info
                </a>
            </p>
          </div>
          <div class="mt-6 lg:mt-0 lg:basis-1/2 space-y-6">
            <div class="grid gap-2 mb-8 border border-gray-200 rounded-md overflow-hidden text-sm shadow">
              <div class="grid grid-cols-2 bg-gray-100 text-gray-800 border-b border-gray-200">
                <div class="px-4 py-2 font-semibold">Team Size</div>
                <div class="px-4 py-2"><span class="font-semibold">Annual Price</span> (USD)</div>
              </div>
              <div class="grid grid-cols-2 border-b border-gray-100">
                <div class="px-4 py-2">Up to <span class="font-semibold">5</span> engineers</div>
                <div class="px-4 py-2">$3,000</div>
              </div>
              <div class="grid grid-cols-2 border-b border-gray-100">
                <div class="px-4 py-2">Up to <span class="font-semibold">10</span> engineers</div>
                <div class="px-4 py-2">$5,000</div>
              </div>
              <div class="grid grid-cols-2 border-b border-gray-100">
                <div class="px-4 py-2">Up to <span class="font-semibold">25</span> engineers</div>
                <div class="px-4 py-2">$10,000</div>
              </div>
              <div class="grid grid-cols-2 border-b border-gray-100">
                <div class="px-4 py-2">Up to <span class="font-semibold">75</span> engineers</div>
                <div class="px-4 py-2">$20,000</div>
              </div>
              <div class="grid grid-cols-2 border-b border-gray-100">
                <div class="px-4 py-2">Up to <span class="font-semibold">150</span> engineers</div>
                <div class="px-4 py-2">$40,000</div>
              </div>
              <div class="grid grid-cols-2 border-b border-gray-100">
                <div class="px-4 py-2">Up to <span class="font-semibold">300</span> engineers</div>
                <div class="px-4 py-2">$80,000</div>
              </div>
                <div class="grid grid-cols-2 border-b border-gray-100">
                <div class="px-4 py-2">Up to <span class="font-semibold">1,000</span> engineers</div>
                <div class="px-4 py-2">$100,000</div>
              </div>
              <div class="grid grid-cols-2">
                <div class="px-4 py-2">Unlimited Usage</div>
                <div class="px-4 py-2">$300,000</div>
              </div>
              <div class="px-4 py-2 text-sm border-t border-gray-200 bg-neutral-100 md:text-center rounded-bl-md rounded-br-md">
                <span class="font-medium">One fixed invoice per year.</span> <span class="block md:inline md:mt-0">No surprise mid-cycle upgrades.</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-6 bg-gray-100 p-6 border border-gray-300 rounded-md shadow">
    <p class="text-xl font-semibold tracking-tight mb-2">
      Not the right time?
    </p>
    <p class="mb-4">
      Want free incident links you can paste into Slack every few weeks? Your team can use the <a href="/coaching" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">web-based version</a> to solve.
    </p>

    <form action="/remind" method="POST" class="flex items-center gap-3 max-w-md">
      <input type="email" name="email" placeholder="you@example.com" required class="border px-3 py-2 rounded w-full border-gray-300 shadow-sm" />
      <button type="submit" class="bg-slate-600 text-white px-3 py-2.5 text-sm font-semibold rounded-md shadow hover:bg-slate-700 active:bg-slate-800 transition focus:outline-none min-w-[150px]">
        Send Incidents
      </button>
    </form>
  </div>
</div>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("demo-form");

    const exampleButtons = document.querySelectorAll(".example-btn");
    const engineer_name = document.querySelector("input[name='engineer_name']");
    const textarea = document.querySelector("textarea[name='incident']");
    const exampleContainer = document.getElementById("example-buttons");

    exampleButtons.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        textarea.value = btn.dataset.example;
        engineer_name.value = btn.dataset.name;
        form.submit(); // Submit the form immediately
      });
    });
  });
</script>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector('form[action="/remind"]');
    const emailInput = form.querySelector('input[name="email"]');
    const submitBtn = form.querySelector('button[type="submit"]');

    // Inline error and success containers
    const errorMsg = document.createElement("div");
    errorMsg.className = "text-red-600 text-sm mt-2";
    form.appendChild(errorMsg);

    const successMsg = document.createElement("div");
    successMsg.className = "text-md";
    successMsg.innerHTML = `
  <div>
    <span class="font-medium">Subscribed!</span> Expect high-signal incidents every few weeks.
  </div>
  <div class="mt-4">
    Try the
    <a href="/coaching" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">
      web-based version
    </a> if you want to level up in the meantime.
  </div>
`;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorMsg.textContent = "";

      const email = emailInput.value.trim();
      const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

      if (!isValid) {
        errorMsg.textContent = "Please enter a valid email address.";
        return;
      }

      try {
        const response = await fetch("/subscribers", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content,
          },
          body: JSON.stringify({ subscriber: { email } }),
        });

        if (response.ok) {
          const heading = form.closest("div").querySelector("p.text-xl");
          const description = heading?.nextElementSibling;

          if (heading) heading.style.display = "none";
          if (description) description.style.display = "none";
          form.replaceWith(successMsg);
        } else {
          errorMsg.textContent = "Something went wrong. Please try again later.";
        }
      } catch (err) {
        errorMsg.textContent = "Network error. Please try again.";
      }
    });
  });
</script>