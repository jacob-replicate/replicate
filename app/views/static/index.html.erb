<div class="flex flex-col lg:flex-row lg:gap-9 pt-4 md:pt-10">
  <!-- Left Column: Headline + Form -->
  <div class="lg:w-1/2 w-full">
    <h1 class="text-2xl md:text-3xl font-semibold tracking-tight mb-2">
      Your next SEV-1 is avoidable.
    </h1>
    <p class="text-gray-800 mb-6 md:mb-4 leading-relaxed text-[17px]">
      Weekly <span class="font-semibold">email-based drills</span> that expose your team's infra blind spots. GPT pushes you to failure, <span class="font-semibold">then</span> coaches.
    </p>

    <div class="md:hidden mb-8">
      <%= render "email_preview" %>
    </div>


    <%= form_for Conversation.new, url: conversations_path, html: { id: "demo-form", class: "hidden lg:block" } do |f| %>
      <div class="rounded-xl border border-neutral-150 bg-neutral-100 p-5 shadow leading-snug">
        <label for="initial_message" class="block font-semibold text-gray-900 leading-snug text-[17px]">
          What broke recently?
        </label>
        <p class="mt-1 text-[15px] text-gray-600 leading-normal">
          Let's figure out what you missed.
        </p>

        <%= text_area_tag :incident, "", class: "mt-4 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-sm text-gray-900 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 focus:ring-0", rows: 3, placeholder: "e.g., retries quietly corrupted the audit trail", tabindex: 1 %>
        <%= hidden_field_tag :engineer_name, "Alex Shaw", name: "engineer_name", class: "hidden" %>

        <p class="mt-3 text-xs text-center text-gray-500">
          By submitting, you agree to the
          <a href="/terms" class="text-blue-500 hover:underline">Terms</a> and
          <a href="/privacy" class="text-blue-500 hover:underline">Privacy Policy</a>
        </p>
      </div>

      <div class="text-center mt-6">
        <%= f.submit 'View a drill based on this SEV&nbsp;&nbsp;&rarr;'.html_safe, class: 'cursor-pointer rounded-lg px-5 py-2.5 text-lg font-semibold text-white bg-slate-600 hover:bg-slate-700 active:bg-slate-800 transition shadow-sm hover:shadow-md focus:outline-none tracking-tight', tabindex: 3 %>
      </div>
      <div class="mt-4 text-sm text-center text-gray-500">
        No logins. No credit cards.
      </div>
    <% end %>
  </div>

  <div class="lg:w-1/2 w-full">
    <div class="hidden md:block">
      <%= render "email_preview" %>
      <div class="mt-3">
        <%= render "signature" %>
      </div>
    </div>
  </div>
</div>

<div>
  <div class="text-md leading-relaxed tracking-[0.008em]">
    <div class="text-[17px]">

      <div class="md:mt-12 max-w-[90ch] text-[17px] leading-relaxed text-gray-800 space-y-6">
        <p>
          This product helps <span class="font-semibold">mid-market engineering teams</span> sharpen their production instincts. It's a <span class="font-semibold">weekly fire drill</span>, over email.
        </p>

        <p>
          GPT drops you into a SEV-1<span class="hidden md:inline"> with some clues</span>, and makes you explain your thoughts until you hit a wall. <span class="block my-6 lg:inline lg:my-0"> No UI. It just shows up in your inbox and applies pressure. Test first, find the infra blind spot that will eventually crash production, <span class="font-semibold">then</span> coach.</span>
        </p>

        <p>
          You can roll it out in <span class="font-semibold">5min</span> during your <span class="font-semibold">3-month trial</span>. Just paste your emails. <span class="font-semibold">No calls</span>. The first SEV hits <span class="font-semibold">next Monday</span>.
        </p>

        <p>
          <span class="font-semibold">80 engineers</span>
          <span class="hidden md:inline">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-3.5 h-3.5 inline text-red-500">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
          </span>
          <span class="md:hidden">running </span><a href="/demo" class="text-blue-600 hover:text-blue-700 font-semibold hover:underline hover:underline-offset-4 decoration-1 transition" target="_blank">weekly SEV drills</a> <span class="hidden md:inline">=</span><span class="md:hidden">means</span> <span class="font-semibold">4,000 reps</span> per year. It only takes one real incident to ruin your team's reputation.
        </p>
      </div>
      <div class="mt-8 lg:mt-12 flex gap-6">
        <% EXAMPLE_EMAILS.each_with_index do |email, i| %>
          <div class="md:basis/1-2 lg:basis-1/3 bg-white border border-neutral-100 shadow rounded-xl p-5 space-y-4 <%= i == 0 ? "hidden md:block" : "" %> <%= i == 1 ? "hidden lg:block" : "" %> <%= i == 2 ? "md:block" : "" %>">
            <div class="flex items-center justify-between align-middle">
              <div class="text-sm text-gray-500"><%= email[:to] %></div>
              <img src="/profile-photo-<%= i + 1 %>.jpg" alt="Avatar" class="w-10 h-10 rounded-full overflow-hidden" />
            </div>

            <div class="text-base font-semibold text-gray-900"><%= email[:subject].html_safe %></div>
            <div class="text-sm text-gray-700 leading-relaxed"><%= email[:content].html_safe %></div>

            <div>
              <a href="#" data-example="<%= email[:prompt] %>" data-name="<%= email[:to] %>" class="example-btn inline-block rounded-md border border-gray-300 bg-white text-sm text-gray-800 font-medium px-3 py-2 hover:bg-neutral-100">
                Prevent the fire
              </a>
            </div>

            <div class="text-xs text-gray-400 pt-2">
              Sent automatically every Monday
            </div>
          </div>
        <% end %>
      </div>
      <div class="mt-8 lg:mt-12">
        <img src="/example-incidents.jpg" class="w-full rounded-xl border border-gray-700" />
      </div>
      <div class="md:hidden mt-4">
        <%= render "signature" %>
      </div>
    </div>
  </div>
  <div class="mt-16 md:mt-20 w-full lg:max-w-[780px] rounded-lg shadow-lg border border-gray-100 bg-white mx-auto">
    <div class="md:flex md:flex-row items-center justify-between bg-[#31363F] px-5 py-3 rounded-t-lg hidden">
      <div class="text-[16px] tracking-tight text-[#EEEEEE] leading-tight">
        Replica lag pinned at 0. Writes duplicating. What's wrong?
      </div>
      <div class="text-[13px] text-zinc-400 font-medium">
        <span class="text-white font-semibold">Next Monday</span>
        <span class="ml-2 text-zinc-400">Sep 8, 2025</span>
      </div>
    </div>

    <div class="text-[16px] p-5">
      <div class="space-y-8 leading-[1.6]">
        <div class="flex justify-start">
          <div class="break-words message-body">
            <div class="font-medium flex items-center gap-2 mb-2">
              <img src="/logo.png" alt="Jacob Comer" class="w-6 h-6 rounded-full" />
              replicate.info
            </div>
            <div class="mt-1">
              Imagine a read replica's monitoring page shows consistent query times under 50ms. Meanwhile, production logs from the primary DB contain intermittent duplicate key errors on inserts. Even with <strong>hot_standby_feedback</strong> on, the replica's lag graph stays flat at 0 seconds. What's your first move?
            </div>
          </div>
        </div>

        <div class="flex justify-end">
          <div class="bg-neutral-100 rounded-2xl shadow px-4 py-3 max-w-2xl md:max-w-xl break-words message-body">
            <div class="font-medium mb-1">Jordan Kim</div>
            Lag staying flat at 0 seconds smells off. I'd treat that monitoring as false.<br>
            Replica config drift feels likely. It's probably querying the wrong instance.<br>
            I'd verify the replica is actually replicating.
          </div>
        </div>

        <div class="flex justify-start">
          <div class="break-words message-body">
            <div class="font-medium flex items-center gap-2 mb-2">
              <img src="/logo.png" alt="Jacob Comer" class="w-6 h-6 rounded-full" />
              replicate.info
            </div>
            <div class="mt-1">
              Lag pinned at zero when symptoms say otherwise is a fault, but not evidence replication is severed. If replication had halted, the replica couldn't show recent data. Query results would diverge fast. What happens when lag monitoring skips over non-blocking replication issues?
            </div>
          </div>
        </div>

        <div class="flex justify-end">
          <div class="bg-neutral-100 rounded-2xl shadow px-4 py-3 max-w-2xl md:max-w-xl break-words message-body">
            <div class="font-medium mb-1">Jordan Kim</div>
            A lag metric at 0 doesn't prove forward replication. I'd confirm commits applied match what the primary sends. If monitoring filters non-blocking issues, what's suppressing sync drift visibility?
          </div>
        </div>

        <div class="flex justify-start">
          <div class="break-words message-body">
            <div class="font-medium flex items-center gap-2 mb-2">
              <img src="/logo.png" alt="Jacob Comer" class="w-6 h-6 rounded-full" />
              replicate.info
            </div>
            <div class="mt-1">
              If lag monitoring skips over non-blocking issues, the replica might apply changes out of order while reporting "caught up." Think about constraints. Which one guarantees upstream sequences won't break if replication's order is wrong?
            </div>
          </div>
        </div>

        <div class="flex justify-end">
          <div class="bg-neutral-100 rounded-2xl shadow px-4 py-3 max-w-2xl md:max-w-xl break-words message-body">
            <div class="font-medium mb-1">Jordan Kim</div>
            Replication order breaking constraints means FK's + unique indexes die first. If those hold steady, we aren't seeing drift. Lag reading zero skips what inconsistency? Data integrity guarantees collapse under what?
          </div>
        </div>

        <div class="flex justify-start">
          <div class="break-words message-body">
            <div class="font-medium flex items-center gap-2 mb-2">
              <img src="/logo.png" alt="Jacob Comer" class="w-6 h-6 rounded-full" />
              replicate.info
            </div>
            <div class="mt-1">
              If constraints were already breaking, you'd see failures escalate quickly. Applications panicking, user reports pouring in. But you expect integrity guarantees to buckle against what? Silent drift hides upstream until reconciliation or... what else breaches first?
            </div>
          </div>
        </div>

        <div class="flex justify-end">
          <div class="bg-neutral-100 rounded-2xl shadow px-4 py-3 max-w-2xl md:max-w-xl break-words message-body">
            <div class="font-medium mb-1">Jordan Kim</div>
            Fuck. I didn't realize I assumed our Kafka consumer's offset tracking guarantees message order across partitions. It doesn't. That risks misapplied transactions. I'll flag the issue with Chris in our 1on1.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-6 w-full lg:max-w-[780px] mx-auto text-center">
    <a href="/sev" class="text-md md:text-[17px] tracking-tight shadow inline-block rounded-lg bg-indigo-700 px-5 py-3 font-semibold text-white transition hover:bg-indigo-800 hover:shadow-md active:bg-indigo-900 sm:w-auto focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400" target="_blank">Try the web-based version</a>.
  </div>
  <div class="mt-4 mb-14 md:mb-0 text-sm text-center text-gray-500">
    No logins. No credit cards.
  </div>

  <div class="mt-8 lg:mt-20">
    <%= render "extended_cta" %>
  </div>
</div>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("demo-form");

    const exampleButtons = document.querySelectorAll(".example-btn");
    const engineer_name = document.querySelector("input[name='engineer_name']");
    const textarea = document.querySelector("textarea[name='incident']");
    const exampleContainer = document.getElementById("example-buttons");

    exampleButtons.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        textarea.value = btn.dataset.example;
        engineer_name.value = btn.dataset.name;
        form.submit(); // Submit the form immediately
      });
    });
  });
</script>

<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector('form[action="/remind"]');
    const emailInput = form.querySelector('input[name="email"]');
    const submitBtn = form.querySelector('button[type="submit"]');

    // Inline error and success containers
    const errorMsg = document.createElement("div");
    errorMsg.className = "text-red-600 text-sm mt-2";
    form.appendChild(errorMsg);

    const successMsg = document.createElement("div");
    successMsg.className = "text-md";
    successMsg.innerHTML = `
  <div>
    <span class="font-medium">Subscribed!</span> Expect high-signal incidents every few weeks.
  </div>
  <div class="mt-4">
    Try the
    <a href="/sev" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">
      web-based version
    </a> if you want to level up in the meantime.
  </div>
`;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorMsg.textContent = "";

      const email = emailInput.value.trim();
      const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

      if (!isValid) {
        errorMsg.textContent = "Please enter a valid email address.";
        return;
      }

      try {
        const response = await fetch("/subscribers", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content,
          },
          body: JSON.stringify({ subscriber: { email } }),
        });

        if (response.ok) {
          const heading = form.closest("div").querySelector("p.text-xl");
          const description = heading?.nextElementSibling;

          if (heading) heading.style.display = "none";
          if (description) description.style.display = "none";
          form.replaceWith(successMsg);
        } else {
          errorMsg.textContent = "Something went wrong. Please try again later.";
        }
      } catch (err) {
        errorMsg.textContent = "Network error. Please try again.";
      }
    });
  });
</script>