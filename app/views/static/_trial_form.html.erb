<form id="email-upload" class="flex flex-col items-center">
  <div class="border border-gray-200 rounded-xl shadow bg-white p-6 <%= form_width_class %>">
    <div class="mb-4">
      Your first batch of emails start <span class="font-semibold">next Monday</span>. No cards. No demos.
    </div>

    <div class="mb-4">
      <span class="font-semibold">Your first 3 months are free.</span> Here are the docs for <a href="/security" target="_blank" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">security</a> and <a href="/billing" target="_blank" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">billing</a>.
    </div>

    <div class="mb-4">
      I'll check in next month if your team is engaging with the tool. Your data gets cleaned up automatically if it doesn't work out. No action required from you.
    </div>

      <div>
        <label for="name-input" class="block font-medium mb-1 tracking-normal">Name</label>
        <input type="text" id="name-input" class="block w-full border border-neutral-300 shadow-sm rounded-md bg-white px-3 py-1.5 text-gray-900 outline-1 -outline-offset-1 outline-indigo-100 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 text-sm" />
      </div>
      <div class="mt-6">
        <label for="email-input" class="block font-medium mb-1 tracking-normal">Email</label>
        <input type="text" id="email-input" class="block w-full border border-neutral-300 shadow-sm rounded-md bg-white px-3 py-1.5 text-gray-900 outline-1 -outline-offset-1 outline-indigo-100 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 text-sm" />
      </div>
      <div class="mt-6">
        <label for="team-emails-input" class="block font-medium tracking-normal">Team Emails</label>
        <div class="text-sm text-gray-600 mb-2">
          Optional. Email <a href="mailto:support@replicate.info" class="text-blue-600 hover:text-blue-700 font-medium hover:underline hover:underline-offset-4 decoration-1 transition">support@replicate.info</a> whenever to make changes.
        </div>
        <textarea id="team-emails-input" rows="4" class="block w-full border border-neutral-300 shadow-sm rounded-md bg-white px-3 py-1.5 text-gray-900 outline-1 -outline-offset-1 outline-indigo-100 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 text-sm" placeholder="(any format works)"></textarea>
      </div>
      <div class="text-xs text-gray-500 mt-4">
        By submitting, you agree to the <a href="/terms" class="text-blue-500 hover:underline">Terms</a> and <a href="/privacy" class="text-blue-500 hover:underline">Privacy Policy</a>.
      </div>
    <!-- CTA -->
    <div class="mt-6 w-full sm:mt-8">
      <button type="submit"
              class="inline-flex w-full items-center justify-center rounded-lg bg-slate-700 px-5 py-3 text-lg font-semibold text-white shadow-sm transition hover:bg-slate-800 hover:shadow-md active:bg-slate-900 sm:w-auto focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400">
        <svg class="mr-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M10.75 3.5l5.75 5.75-5.75 5.75v-3.5H4.5v-4.5h6.25v-3.5z"/>
        </svg>
        Begin Coaching
      </button>
    </div>
  </div>
</form>


<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const coachingForm = document.querySelector("email-upload");
    if (coachingForm) {
      coachingForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name-input")?.value?.trim();
        const email = document.getElementById("email-input")?.value?.trim();
        const engineerEmails = document.getElementById("team-emails-input")?.value?.trim();

        if (!name || !email || !engineerEmails) {
          alert("Please fill out all fields.");
          return;
        }

        try {
          const response = await fetch("/organizations", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]')?.content
            },
            body: JSON.stringify({ name, email, engineer_emails: engineerEmails })
          });

          if (!response.ok) throw new Error("Request failed");

          const formWrapper = document.getElementById("email-upload");
          formWrapper.innerHTML = `
          <div class="text-center text-md text-gray-800 py-6 mt-8">
            <span class="font-medium">You're in. The first email goes out Monday.</span>
            <div class="mt-2">
              <a href="/coaching" class="text-blue-600 hover:text-blue-700 hover:underline hover:underline-offset-4 decoration-1 transition">Test your production instincts.&nbsp;&rarr;</a>
            </div>
          </div>
        `;
        } catch (error) {
          alert("Something went wrong. Please try again.");
        }
      });
    }
  });
</script>